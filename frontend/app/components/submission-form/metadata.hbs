<form class="vstack gap-3" {{on 'submit' (prevent-default @nav.goNext)}}>
  <div class="card">
    <div class="card-body bg-lighth">
      <p>すべての配列ファイルの合計エントリ数と、公開予定日 (Hold date) の希望があれば入力してください。</p>

      <div class="row row-cols-2">
        <div class="col">
          <label for="entriesCount" class="form-label">エントリ数</label>
          <input type="number" value={{@model.entriesCount}} readonly={{not @state.fileSet.isEmpty}} required min="1" class="form-control" id="entriesCount" {{on 'change' (pick 'target.value' (set @model 'entriesCount'))}} />
        </div>

        <div class="col vstack gap-1">
          <div>
            <label for="holdDate" class="form-label">公開予定日</label>
            <input type="date" value={{@model.holdDate}} readonly={{not @state.fileSet.isEmpty}} disabled={{@state.releaseImmediately}} required class="form-control" id="holdDate" {{on 'change' (pick 'target.value' (set @model 'holdDate'))}} />
          </div>

          <div class="form-check">
            <input type="checkbox" checked={{@state.releaseImmediately}} disabled={{not @state.fileSet.isEmpty}} class="form-check-input" id="releaseImmediately" {{on 'change' (pick 'target.checked' this.setReleaseImmediately)}} />
            <label for="releaseImmediately" class="form-check-label">即時公開</label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <p>登録ファイルの contact 行に記載する1名の登録責任者（コンタクトパーソン）について記載してください。</p>

      <div class="row row-cols-2 gy-3">
        {{#let @model.contactPerson as |person|}}
          <div class="col">
            <label for="contactPerson.email" class="form-label">E-mail アドレス</label>
            <input type="email" value={{person.email}} readonly={{@state.isContactPersonReadonly}} required class="form-control" id="contactPerson.email" {{on 'change' (pick 'target.value' (set person 'email'))}} />
          </div>

          <div class="col">
            <label for="contactPerson.fullName" class="form-label">フルネーム (英語表記)</label>
            <input type="text" value={{person.fullName}} readonly={{@state.isContactPersonReadonly}} required maxlength="255" class="form-control" id="contactPerson.fullName" {{on 'change' (pick 'target.value' (set person 'fullName'))}} />
          </div>

          <div class="col">
            <label for="contactPerson.affiliation" class="form-label">所属名 (英語表記)</label>
            <input type="text" value={{person.affiliation}} readonly={{@state.isContactPersonReadonly}} required maxlength="255" class="form-control" id="contactPerson.affiliation" {{on 'change' (pick 'target.value' (set person 'affiliation'))}} />
          </div>
        {{/let}}
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <p>コンタクトパーソン以外に登録担当がおり、Accession、公開お知らせ通知を受けたい場合は、このセクションに記入してください。</p>

      <div class="card">
        <ul class="list-group list-group-flush">
          {{#each @model.otherPeople as |person i|}}
            <li class="list-group-item">
              <div class="row">
                <div class="col">
                  <label for="otherPerson.{{i}}.email" class="form-label">E-mail アドレス</label>
                    <input type="email" value={{person.email}} required={{true}} class="form-control" id="otherPerson.{{i}}.email" {{on 'change' (pick 'target.value' (set person 'email'))}} />
                </div>

                <div class="col">
                  <label for="otherPerson.{{i}}.fullName" class="form-label">フルネーム (英語表記)</label>
                    <input type="text" value={{person.fullName}} required={{true}} maxlength="255" class="form-control" id="otherPerson.{{i}}.fullName" {{on 'change' (pick 'target.value' (set person 'fullName'))}} />
                </div>

                <div class="col-auto align-self-center">
                  <button type="button" class="btn btn-link p-2" {{on 'click' (prevent-default (fn this.removeOtherPerson person))}}>
                    {{svg-jar 'no-entry-24' class='octicon fill-danger' role='img' desc='削除'}}
                  </button>
                </div>
              </div>
            </li>
          {{else}}
            <li class="list-group-item py-3 text-muted text-center">
              登録されていません。
            </li>
          {{/each}}
        </ul>

        <div class="card-footer bg-white">
          <button type="button" class="btn btn-outline-primary" {{on 'click' (prevent-default this.addOtherPerson)}}>
            連絡先の追加
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <p>塩基配列決定にどのタイプのシークエンサーを使用しましたか。</p>

      <RadioGroup as |group|>
        {{#each (enum 'sequencers') as |sequencer|}}
          <div class="form-check">
            <group.radio as |radio|>
              <radio.input checked={{eq @model.sequencer sequencer.key}} class="form-check-input" required {{on 'change' (set @model 'sequencer' sequencer.key)}} />

              <radio.label class="form-check-label">
                {{sequencer.label}}
              </radio.label>
            </group.radio>
          </div>
        {{/each}}
      </RadioGroup>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <label for="dataType" class="form-label">データ種別を選択してください。</label>

      <select required class="form-select" id="dataType" {{on 'change' (pick 'target.value' (set @model 'dataType'))}}>
        <option selected={{is-none @model.dataType}}></option>

        {{#each (enum 'data_types') as |type|}}
          <option value={{type.key}} selected={{eq @model.dataType type.key}}>
            {{type.label}}
          </option>
        {{/each}}
      </select>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <p>Submission データの補足説明をここに記入してください（日本語可、30文字以上1,000文字以内）。</p>
      <p>生物の説明（common nameや性質など）、単離生物由来でない場合は塩基配列をどうやって得たのか、そのほか、キュレータに知らせたいこと等を入力できます。DDBJ に登録した配列を更新する場合は対象の Accession を記入してください。</p>

      <div>
        <label for="description" class="form-label visually-hidden">補足説明</label>
        <textarea required minlength="30" maxlength="1000" rows="8" placeholder="e.g.活性汚泥から単離した Dibenzothiophene分解能を有するPseudomonas属ストレイン5種のドラフトゲノム配列にアノテーションをつけたもの" class="form-control" id="description" {{on 'input' (pick 'target.value' (set @model 'description'))}}>{{@model.description}}</textarea>

        <div class="form-text text-end">
          {{or @model.description.length 0}} / 1000
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <p>通知するEメールの言語を選択してください。</p>

      <RadioGroup as |group|>
        {{#each (enum 'locales') as |locale|}}
          <div class="form-check">
            <group.radio as |radio|>
              <radio.input checked={{eq @model.emailLanguage locale.key}} required class="form-check-input" {{on 'change' (set @model 'emailLanguage' locale.key)}} />

              <radio.label class="form-check-label">
                {{t (concat 'locales.' locale.key) locale=locale.key}}
              </radio.label>
            </group.radio>
          </div>
        {{/each}}
      </RadioGroup>
    </div>
  </div>

  <div class="hstack gap-3 justify-content-end">
    <a href class="btn btn-outline-primary px-4" {{on 'click' (prevent-default @nav.goPrev)}}>戻る</a>
    <button type="submit" class="btn btn-primary px-5">次へ</button>
  </div>
</form>
